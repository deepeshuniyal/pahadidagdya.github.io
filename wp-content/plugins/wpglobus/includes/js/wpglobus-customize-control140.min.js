jQuery(document).ready(function(t){"use strict";var e={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,selectorHtml:'<span style="margin-left:5px;" class="wpglobus-icon-globe"></span><span style="font-weight:bold;">{{language}}</span>',init:function(o){e.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(t.each(WPGlobusCoreData.enabled_languages,function(t,o){e.languages[t]=o,e.length=t}),e.addLanguageSelector(),e.setControlInstances(),e.setFieldsSection(),e.attachListeners())},setFieldsSection:function(){var e={},o=t(".wpglobus-fields_settings_control_box").data("section-template"),n="",s="",l="";t.each(WPGlobusCustomize.controlInstances,function(t,o){void 0===e[o.section]&&(e[o.section]={}),e[o.section][t]=o}),t.each(e,function(e,i){s="<ul>",t.each(i,function(t,e){l=e.userControl.enabled?" checked ":"",s+='<li><input id="wpglobus-cb-control-'+t+'" data-control="'+t+'" class="wpglobus-customize-cb-control" type="checkbox"'+l+" /> "+e.title+"</li>"}),s+="</ul>",n=o.replace("{{section_title}}",wp.customize.section(e).params.title),n=n.replace(/{{section}}/g,e),n=n.replace("{{section_id}}",'"'+e+'"'),n=n.replace("{{items}}",s),t(n).insertBefore(t("#"+WPGlobusCustomizeOptions.userControlSaveButton))}),t("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),t(WPGlobusCustomizeOptions.helpButton).insertAfter(t("#accordion-section-wpglobus_fields_settings_section .customize-action")),t("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),t("."+WPGlobusCustomizeOptions.userControlIconClass).on("click",function(e){var o=t(this).data("section");t(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(e,n){o==t(n).data("section")?t(this).css({display:"block"}):t(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand()}),t(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(e){t("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(e,o){var n=o.controlSelector+" "+o.selector,s='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+o.section+'" style="position:absolute;right:0px;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';t(s).insertBefore(n),o.userControl.enabled||(t(n).length>1?t(n).each(function(e,o){t(o).removeClass(WPGlobusCustomize.controlClass)}):t(n).removeClass(WPGlobusCustomize.controlClass).val(o.setting))},ctrlMenuItemsCallback:function(t,e){},ctrlWidgetCallback:function(o,n){if(e.action=!1,void 0===e.controlWidgets[o].element){void 0===n&&(n=wp.customize.control.instance(o)),e.controlWidgets[o].element={},e.controlWidgets[o].control=n,e.controlWidgets[o].inWidgetTitle=n.container.find(".in-widget-title");var s=n.container.find("input[type=submit]");0!=s.length&&(s.css({display:"block"}),s.attr("data-widget",o),e.controlWidgets[o].submit=s,e.attachWidgetListeners(e.controlWidgets[o])),n.liveUpdateMode=!1,void 0===n.setting().title?e.controlWidgets[o].inWidgetTitle.text(""):e.controlWidgets[o].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(n.setting().title,WPGlobusCustomize.languageAdmin)),t.each(WPGlobusCustomize.elementSelector,function(s,l){var i=n.container.find(l);0!=i.length&&t.each(i,function(s,a){if(void 0===a.id||""==a.id)return!0;var c=t(i[s]);void 0===e.controlWidgets[o].element[a.id]&&(e.controlWidgets[o].element[a.id]={}),c.addClass("wpglobus-customize-widget-control"),c.attr("data-widget",o),e.controlWidgets[o].element[a.id].element=c,e.controlWidgets[o].element[a.id].setting=n.setting(),e.controlWidgets[o].element[a.id].selector=l,e.controlWidgets[o].element[a.id].value=a.defaultValue,c.val(WPGlobusCore.TextFilter(a.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),t(document).triggerHandler("wpglobus_customize_control_added_widget",[o])}},ctrlCallback:function(o,n,s){var l=!1;if(t.each(WPGlobusCustomize.disabledSections,function(t,e){if(o.section()==e)return l=!0,!1}),!l&&(t.each(WPGlobusCustomize.disabledSettingMask,function(t,e){if(n.indexOf(e)>=0)return l=!0,!1}),!l)){var i=wp.customize.control.instance(n);if(n.indexOf("widget")>=0)return void 0===e.controlWidgets[n]&&(e.controlWidgets[n]={},e.action&&e.ctrlWidgetCallback(n,i)),e.controlWidgets[n].parent=i.selector,!1;if(void 0===e.controlInstances[n]){var a=!0;t.each(WPGlobusCustomize.elementSelector,function(o,s){var l=i.container.find(s);0!=l.length&&(e.controlInstances[n]={},e.controlInstances[n].element=l,e.controlInstances[n].setting=i.setting(),e.controlInstances[n].selector=s,e.controlInstances[n].controlSelector=i.selector,e.controlInstances[n].type="",e.controlInstances[n].section=i.section(),e.controlInstances[n].title=null,e.controlInstances[n].userControl=null,t.each(WPGlobusCustomize.setLinkBy,function(t,o){n.indexOf(o)>=0&&(e.controlInstances[n].type="link",""==e.controlInstances[n].setting&&(e.controlInstances[n].setting=l[0].defaultValue),l.addClass("wpglobus-control-link"))}),""===e.controlInstances[n].type&&(e.controlInstances[n].type="textarea"==s?"textarea":"text"),l.val(WPGlobusCore.TextFilter(e.controlInstances[n].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),l.addClass("wpglobus-customize-control"),l.attr("data-wpglobus-customize-control",e.controlInstances[n].controlSelector.replace("#customize-control-","")),"link"==e.controlInstances[n].type&&(e.controlInstances[n].setting=e.convertString(l[0].defaultValue)),e.controlInstances[n].title=t(i.selector+" .customize-control-title").text(),null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&(a=!1),e.controlInstances[n].userControl={},e.controlInstances[n].userControl.enabled=a,e.setUserControls(n,e.controlInstances[n]))})}}},setControlInstances:function(){wp.customize.control.each(e.ctrlCallback)},setTitle:function(){t(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(e){if(void 0===e)return e;var o=[],n=WPGlobusCore.getTranslations(e),s=0,l=!0;return t.each(n,function(t,e){""==e?o[s]="null":(l=!1,o[s]=e),s++}),l?"":o.join("|||")},getTranslations:function(e){var o={},n=e.split("|||");return t.each(WPGlobusCoreData.enabled_languages,function(t,e){o[e]="undefined"===n[t]||"null"===n[t]?"":n[t]}),o},getString:function(o,n,s){if(void 0===o)return o;void 0===n&&(n=""),void 0===s&&(s=WPGlobusCoreData.language);var l=e.getTranslations(o),i=[],a=0;return t.each(l,function(t,e){i[a]=t==s?n:""==e?"null":e,a++}),i=i.join("|||")},addLanguageSelector:function(){t(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),t(".wpglobus-customize-selector").html(e.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),t(document).on("click",".wpglobus-customize-selector",function(o){e.index>e.length-1?e.index=0:e.index++,WPGlobusCoreData.language=e.languages[e.index],t(this).html(e.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),t(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),t(".wpglobus-customize-control").each(function(o,n){var s=t(n),l=s.data("customize-setting-link");if(void 0!==WPGlobusCustomize.controlInstances[l]||(l=s.data("wpglobus-customize-control"),void 0!==WPGlobusCustomize.controlInstances[l]))if(s.hasClass("wpglobus-control-link")){var i=e.getTranslations(WPGlobusCustomize.controlInstances[l].setting);s.val(i[WPGlobusCoreData.language])}else s.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[l].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))}),t(".wpglobus-customize-widget-control").each(function(e,o){var n=t(o),s=n.data("widget");if(void 0===n.attr("id"))return!0;n.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[s].element[n.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})})},updateElements:function(o){void 0===o&&(o=!0),t.each(WPGlobusCustomize.controlInstances,function(t,n){if(!n.userControl.enabled)return!0;var s=wp.customize.control.instance(t);if("link"==n.type){var l=e.getTranslations(WPGlobusCustomize.controlInstances[t].setting);o?(s.setting.set(l[WPGlobusCoreData.language]),n.element.val(s.setting())):n.element.val(l[WPGlobusCoreData.language])}else o?(s.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),n.element.val(s.setting())):n.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(o){"mouseenter"==o.type?t.each(e.controlWidgets[t(this).data("widget")].element,function(e,o){t("#"+e).val(o.value)}):"mouseleave"==o.type?e.widgetKeep||t.each(e.controlWidgets[t(this).data("widget")].element,function(e,o){t("#"+e).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==o.type&&(e.widgetKeep=!0)},attachWidgetListeners:function(o){void 0!==o.submit[0].id&&t(document).on("mouseenter","#"+o.submit[0].id,e.onSubmitEvents).on("mouseleave","#"+o.submit[0].id,e.onSubmitEvents).on("click","#"+o.submit[0].id,e.onSubmitEvents)},attachListeners:function(){t(".wpglobus-customize-control").on("keyup",function(o){var n=t(this),s=n.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[s]&&(s=n.data("wpglobus-customize-control"),void 0===WPGlobusCustomize.controlInstances[s])||("link"==WPGlobusCustomize.controlInstances[s].type?WPGlobusCustomize.controlInstances[s].setting=e.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[s].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language))}),t(document).on("keyup",".wpglobus-customize-widget-control",function(e){var o=t(this),n=o.data("widget");void 0!==WPGlobusCustomize.controlWidgets[n]&&(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value,o.val(),WPGlobusCoreData.language))}),t("#save").on("mouseenter",function(e){t.each(WPGlobusCustomize.controlInstances,function(t,e){if(e.userControl.enabled){var o=wp.customize.control.instance(t);o.setting.set(e.setting),e.element.val(o.setting())}})}).on("mouseleave",function(t){e.instancesKeep||e.updateElements()}).on("click",function(t){e.instancesKeep=!0}),t(document).on("ajaxComplete",function(o,n){void 0!==n.responseText&&('{"success":true,"data":[]}'==n.responseText?e.updateElements(!1):(n.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&(e.action="customizerAjaxComplete",e.setControlInstances()),t.each(WPGlobusCustomize.controlWidgets,function(o,s){var l=o.replace("_","-");if(n.responseText.indexOf(l)>=0)return s.submit.css({display:"block"}),s.control.liveUpdateMode=!1,t.each(s.element,function(e,o){t("#"+e).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),s.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(s.control.setting().title,WPGlobusCustomize.languageAdmin)),e.widgetKeep=!1,!1})))}),t(document).on("click",".widget-title, .widget-title-action",function(o){var n=t(this).parents(".customize-control-widget_form").attr("id");t.each(e.controlWidgets,function(t,o){if("#"+n==o.parent)return e.ctrlWidgetCallback(t),!1})})}};WPGlobusCustomize=t.extend({},WPGlobusCustomize,e),WPGlobusCustomize.init()});